---
layout: default
title: Crea tu Top 5
---

<style>
    /* --- ESTILOS GENERALES --- */
    body {
        background-color: #0d0d0d;
        color: white;
        user-select: none; /* Evitar selección de texto al arrastrar */
        touch-action: pan-y; /* Mejorar scroll en móvil */
    }

    .maker-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
        display: flex;
        flex-direction: column;
        gap: 40px;
    }

    .maker-header { text-align: center; margin-bottom: 20px; }
    .maker-header h1 { font-weight: 900; font-size: 3rem; margin: 0; text-transform: uppercase; letter-spacing: -1px; }
    .maker-header p { color: #b3b3b3; font-size: 1.1rem; margin-top: 10px; }

    /* --- ZONA DEL RANKING (PODIO) --- */
    .ranking-zone {
        display: flex;
        flex-direction: column;
        gap: 15px;
        background: #181818;
        padding: 30px;
        border-radius: 12px;
        border: 1px solid #333;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .rank-slot {
        display: flex;
        align-items: center;
        background: #282828;
        border-radius: 8px;
        padding: 10px;
        height: 100px; /* Altura fija para el slot */
        border: 2px dashed #444;
        transition: 0.2s;
        position: relative;
    }

    .rank-slot.drag-over {
        background: #333;
        border-color: #1DB954;
        transform: scale(1.02);
    }

    /* Números del ranking */
    .rank-number {
        font-size: 3rem;
        font-weight: 900;
        color: #444;
        margin-right: 20px;
        width: 50px;
        text-align: center;
        font-family: 'Segoe UI', sans-serif; /* Fuente neutra para números */
    }
    
    /* Colores para el Top 3 */
    .slot-1 .rank-number { color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
    .slot-2 .rank-number { color: #C0C0C0; }
    .slot-3 .rank-number { color: #CD7F32; }

    /* Contenedor de la imagen droppeada */
    .dropped-item {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        cursor: pointer;
        animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .dropped-info {
        margin-left: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .dropped-title { font-weight: 800; font-size: 1.1rem; color: #fff; }
    .dropped-artist { font-size: 0.9rem; color: #b3b3b3; }

    /* Mensaje vacío */
    .empty-msg {
        color: #555;
        font-style: italic;
        font-size: 0.9rem;
        position: absolute;
        left: 90px;
        pointer-events: none;
    }

    /* --- ZONA DE DISCOS (POOL) --- */
    .pool-section {
        margin-top: 20px;
    }
    
    .pool-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
    }

    .pool-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 15px;
        padding: 20px;
        background: #121212;
        border-radius: 12px;
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #333;
    }

    .draggable-album {
        width: 100%;
        aspect-ratio: 1/1;
        object-fit: cover;
        border-radius: 6px;
        cursor: grab;
        transition: transform 0.2s, opacity 0.2s;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .draggable-album:hover { transform: scale(1.1); border: 2px solid #1DB954; }
    .draggable-album:active { cursor: grabbing; }
    
    /* Clase para ocultar álbumes que ya están en el ranking */
    .draggable-album.used {
        opacity: 0.2;
        pointer-events: none;
        filter: grayscale(100%);
    }

    /* Animación de entrada */
    @keyframes popIn {
        from { transform: scale(0); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    /* BOTONES DE ACCIÓN */
    .action-btn {
        background: #1DB954;
        color: black;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        font-weight: 800;
        cursor: pointer;
        text-transform: uppercase;
        font-size: 0.9rem;
        transition: 0.2s;
    }
    .action-btn:hover { transform: scale(1.05); background: #1ed760; }
    .reset-btn { background: transparent; color: #fff; border: 1px solid #555; }
    .reset-btn:hover { background: #333; border-color: #fff; transform: none; }

</style>

<div class="maker-container">
    
    <div class="maker-header">
        <h1>Tu Top 5 Urbano</h1>
        <p>Arrastra los álbumes de la colección para crear tu ranking definitivo.</p>
    </div>

    <!-- ZONA DE RANKING -->
    <div class="ranking-zone" id="rankingZone">
        <!-- Slot 1 -->
        <div class="rank-slot slot-1" ondrop="drop(event)" ondragover="allowDrop(event)" data-rank="1">
            <span class="rank-number">1</span>
            <span class="empty-msg">Arrastra aquí tu favorito</span>
        </div>
        <!-- Slot 2 -->
        <div class="rank-slot slot-2" ondrop="drop(event)" ondragover="allowDrop(event)" data-rank="2">
            <span class="rank-number">2</span>
        </div>
        <!-- Slot 3 -->
        <div class="rank-slot slot-3" ondrop="drop(event)" ondragover="allowDrop(event)" data-rank="3">
            <span class="rank-number">3</span>
        </div>
        <!-- Slot 4 -->
        <div class="rank-slot" ondrop="drop(event)" ondragover="allowDrop(event)" data-rank="4">
            <span class="rank-number">4</span>
        </div>
        <!-- Slot 5 -->
        <div class="rank-slot" ondrop="drop(event)" ondragover="allowDrop(event)" data-rank="5">
            <span class="rank-number">5</span>
        </div>
    </div>

    <!-- ZONA DE ÁLBUMES DISPONIBLES -->
    <div class="pool-section">
        <div class="pool-header">
            <span style="font-weight:700; color:#1DB954; text-transform:uppercase;">Colección Completa</span>
            <button class="action-btn reset-btn" onclick="resetRanking()">Reiniciar</button>
        </div>
        
        <div class="pool-grid" id="albumPool">
            {% assign items = site.data[site.metadata] | where_exp: 'item','item.objectid' %}
            {% for item in items %}
                {% if item.filename contains '/' %}
                    {% assign img_url = item.filename %}
                {% else %}
                    {% assign img_url = item.filename | prepend: '/objects/' | relative_url %}
                {% endif %}
                
                <img src="{{ img_url }}" 
                     alt="{{ item.title }}" 
                     class="draggable-album" 
                     draggable="true" 
                     ondragstart="drag(event)" 
                     id="album-{{ item.objectid }}"
                     data-title="{{ item.title }}"
                     data-artist="{{ item.creator }}">
            {% endfor %}
        </div>
    </div>

</div>

<script>
    /* --- LÓGICA DE DRAG & DROP --- */
    
    function allowDrop(ev) {
        ev.preventDefault();
        // Añadir clase visual
        ev.currentTarget.classList.add('drag-over');
    }

    // Limpiar estilo visual al salir (opcional pero recomendado)
    document.querySelectorAll('.rank-slot').forEach(slot => {
        slot.addEventListener('dragleave', () => {
            slot.classList.remove('drag-over');
        });
    });

    function drag(ev) {
        // Guardamos el ID del elemento arrastrado
        ev.dataTransfer.setData("text", ev.target.id);
        // Efecto visual
        ev.target.style.opacity = "0.5";
    }

    // Resetear opacidad si se cancela el drag
    document.addEventListener("dragend", function(event) {
        event.target.style.opacity = "1";
    });

    function drop(ev) {
        ev.preventDefault();
        // Quitar clase visual
        ev.currentTarget.classList.remove('drag-over');

        var data = ev.dataTransfer.getData("text");
        var originalImg = document.getElementById(data);
        
        // El target puede ser el div del slot o un hijo. Aseguramos el slot.
        var slot = ev.target.closest('.rank-slot');

        // Si ya hay algo en el slot, lo "devolvemos" (visualmente reseteamos el original)
        // Aquí hacemos una lógica simple: Limpiamos el slot y ponemos lo nuevo
        
        // 1. Marcar imagen original como "usada"
        originalImg.classList.add('used');

        // 2. Crear el HTML para el slot
        const imgSrc = originalImg.src;
        const title = originalImg.getAttribute('data-title');
        const artist = originalImg.getAttribute('data-artist');

        // Si el slot ya tenía algo, buscamos esa imagen en el pool y la reactivamos
        const existingImg = slot.querySelector('.dropped-item');
        if (existingImg) {
            const oldId = existingImg.getAttribute('data-origin-id');
            document.getElementById(oldId).classList.remove('used');
        }

        // 3. Inyectar contenido en el slot
        // Mantenemos el número del ranking y añadimos el contenido
        const rankNum = slot.querySelector('.rank-number').outerHTML;
        
        slot.innerHTML = `
            ${rankNum}
            <img src="${imgSrc}" class="dropped-item" onclick="removeFromSlot(this)" data-origin-id="${data}">
            <div class="dropped-info">
                <span class="dropped-title">${title}</span>
                <span class="dropped-artist">${artist}</span>
            </div>
            <button onclick="removeBtnClick(this)" style="margin-left:auto; background:none; border:none; color:#555; cursor:pointer; font-size:1.2rem;">&times;</button>
        `;
    }

    /* --- ELIMINAR DEL RANKING --- */
    function removeFromSlot(imgElement) {
        // Reactivar en el pool
        const originId = imgElement.getAttribute('data-origin-id');
        document.getElementById(originId).classList.remove('used');

        // Limpiar slot
        const slot = imgElement.closest('.rank-slot');
        const rankNum = slot.querySelector('.rank-number').outerHTML;
        const emptyText = slot.classList.contains('slot-1') ? "Arrastra aquí tu favorito" : "";
        
        slot.innerHTML = `
            ${rankNum}
            ${emptyText ? `<span class="empty-msg">${emptyText}</span>` : ''}
        `;
    }

    function removeBtnClick(btn) {
        // Helper para el botón X
        const img = btn.parentNode.querySelector('.dropped-item');
        removeFromSlot(img);
    }

    function resetRanking() {
        if(!confirm('¿Borrar todo tu Top 5?')) return;
        
        // Limpiar todos los slots
        document.querySelectorAll('.rank-slot').forEach(slot => {
            const img = slot.querySelector('.dropped-item');
            if(img) removeFromSlot(img);
        });
    }

    /* --- SOPORTE MÓVIL SIMPLE (TAP TO SELECT) --- */
    // Para móviles, como DragDrop es complejo, añadimos clic simple
    let selectedForMobile = null;

    document.querySelectorAll('.draggable-album').forEach(img => {
        img.addEventListener('click', function() {
            // Si es pantalla táctil o pequeña
            if(window.innerWidth < 800) {
                if(this.classList.contains('used')) return;
                
                // Efecto visual de selección
                document.querySelectorAll('.draggable-album').forEach(i => i.style.border = 'none');
                this.style.border = '3px solid #1DB954';
                selectedForMobile = this;
                
                alert('Álbum seleccionado. Ahora toca un puesto (1-5) arriba para colocarlo.');
            }
        });
    });

    document.querySelectorAll('.rank-slot').forEach(slot => {
        slot.addEventListener('click', function() {
            if(window.innerWidth < 800 && selectedForMobile) {
                // Simular drop
                const mockEv = { 
                    preventDefault: () => {}, 
                    currentTarget: this, 
                    target: this,
                    dataTransfer: { getData: () => selectedForMobile.id } 
                };
                
                // Limpiar estilo selección
                selectedForMobile.style.border = 'none';
                
                drop(mockEv);
                selectedForMobile = null;
            }
        });
    });

</script>